<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.tarena.fh.mapper.LeaveBillMapper">
	<resultMap id="leaveBillRM" type="LeaveBill" autoMapping="true">
		<id property="id" column="id"/>
		<association property="user" javaType="User">
			<id property="userId" column="user_id"/>
			<result property="username" column="username"/>
		</association>
	</resultMap>

	<insert id="insert" parameterType="LeaveBill">
		INSERT INTO a_leavebill(days,content,remark,leaveDate,state,user_id) VALUES (
			#{days,jdbcType=INTEGER},
			#{content,jdbcType=VARCHAR},
			#{remark,jdbcType=VARCHAR},
			#{leaveDate,jdbcType=DATE},
			#{state,jdbcType=INTEGER},
			#{user.userId,jdbcType=VARCHAR}
		)
	</insert>

	<select id="findLBListByUID" resultMap="leaveBillRM">
		SELECT lb.*,u.username FROM
		a_leavebill lb
			LEFT JOIN
		user_p u
		ON lb.user_id=u.user_id WHERE lb.user_id = #{userId}
	</select>

	<select id="findOne" resultMap="leaveBillRM">
		SELECT lb.*,u.username FROM
		a_leavebill lb
			LEFT JOIN
		user_p u
		ON lb.user_id=u.user_id WHERE lb.id = #{id}
	</select>

	<update id="updateState">
		UPDATE a_leavebill SET state=#{state} WHERE id=#{id}
	</update>

	<delete id="deleteById">
		DELETE FROM a_leavebill WHERE id=#{id}
	</delete>

	<update id="update" parameterType="LeaveBill">
		UPDATE a_leavebill
		<set>
			<if test="days!=null">days=#{days},</if>
			<if test="content!=null">content=#{content},</if>
			<if test="remark!=null">remark=#{remark},</if>
			<if test="leaveDate!=null">leaveDate=#{leaveDate,jdbcType=DATE},</if>
			<if test="state!=null">state=#{state},</if>
			<if test="user!=null">user_id=#{user.userId}</if>
		</set>
		WHERE id=#{id}
	</update>
</mapper>